<!DOCTYPE html>
<html>
<head>
  <title>Untitled</title>
  <meta name="generator" content="Radi by Lacquer version 0.9.8" />      <!-- download Radi at http://radiapp.com -->
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

  <style>
body, html { margin: 0; padding: 0; color: #000; font-family: Helvetica, Arial, sans; font-size: 12px; }
body { background-color: white; }
 
</style>

  <script type="text/javascript" src="ccb.js"></script> <!-- This page needs JQuery to handle events like page resize or mouse clicks. If you don't want this script loaded, you can disable automatic layout and interaction for elements in Radi and republish. -->

  
  <script type="text/javascript">
/*  This script generated by Radi - http://radiapp.com

    The Radi JavaScript base library (reproduced within this script) is Copyright 2010-13 Lacquer oy/ltd and released under the so-called MIT license.
    You can freely modify and redistribute this script or portions of it on the following condition:
       The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

    This script may also contain portions that were automatically generated by the Radi software from user-provided content
    (such as vector graphics objects and/or custom rendering scripts). That content may be copyrighted by its author(s).
    Lacquer oy/ltd makes no claim of copyright over any content within this script which is not part of the Radi base library.
*/
if (window.requestAnimationFrame === undefined) {
  window.requestAnimationFrame = window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
}
if (window.Radi === undefined) window.Radi = {};
if (Radi.documents === undefined) Radi.documents = {};

Radi.documents['time'] = (function() {
var frameRate = 24;
var durationInFrames = 100;
var currentFrame = 0;
var canPlay = true;
var isPlaying = true;
var animDidStart = false;

var assets = [];

function preloadAssets() {
  for (var i = 0; i < assets.length; i++) {
    var a = assets[i];
    if (a.type === "image" && a.url && !a.img && a.allowPreload) {
      a.img = new Image();
      a.img.src = a.url;
    }
  }
}
function getAssetByName(wanted) {
  for (var i = 0; i < assets.length; i++) {
    if (assets[i].name === wanted) return assets[i];
  }
  return null;
}

var env = { 'durationInFrames': durationInFrames, 'frameRate': frameRate, 'currentFrame': currentFrame };  /* 'env' provides public Radi properties to custom script layers */

function LayerBase(index, lid, element, name, props) {
  this.layerIndex = index;
  this.layerID = lid || ('layer'+index);
  this.name = name || '';
  this.containingElementID = element;
  this.renderProperties = props || {};
  this.variesOverTime = this.renderProperties.variesOverTime || false;
  this.c_opacity = 1;
  this.c_trs = [1, 0, 0, 1, 0, 0];
  this.applyKf = function(frame) {
    this.c_opacity = (this.opValues && (this.opValues.length > frame)) ? this.opValues[frame] : ((this.opValues && this.opValues.length > 0) ? this.opValues[this.opValues.length-1] : 1);
    var trskf = (this.trsValues && (this.trsValues.length > frame)) ? this.trsValues[frame] : null;
    this.c_trs = trskf || (this.prevkf_trs || [1, 0, 0, 1, 0, 0]);
    this.c_invTrs = (this.invTrsValues && (this.invTrsValues.length > frame)) ? this.invTrsValues[frame] : null;
    if (trskf) this.prevkf_trs = trskf;
  }
}

function ShapeLayer(index, lid, elem, name, props) {
  LayerBase.call(this, index, lid, elem, name, props);
}
function ScriptLayer(index, lid, elem, name, props) {
  LayerBase.call(this, index, lid, elem, name, props);
  this.scriptParams = {};
}
function ImageLayer(index, lid, elem, name, props) {
  LayerBase.call(this, index, lid, elem, name, props);
}
function TextLayer(index, lid, elem, name, props) {
  LayerBase.call(this, index, lid, elem, name, props);
}

function Content_time_z2_textlayer(a_layerIndex, a_layerID, a_containingElement, a_name, a_renderProperties) {
  TextLayer.call(this, a_layerIndex, a_layerID, a_containingElement, a_name, a_renderProperties);
  
  this.opValues = [ 1 ];
  this.trsValues = [[1,0,0,1,397,172] ];
  
  this.contentimg = new Image();
  this.contentimg.hasLoaded = false;
  this.contentimg.onload = function(){ this.hasLoaded = true; };
  this.contentimg.src = 'time_z2_textlayer.png';
  
  this.generateInCanvas = function(canvas, layers) {
    var ctx = canvas.getContext('2d'); 
    var w = canvas.width;
    var h = canvas.height;
    var img = (this.contentimg && this.contentimg.hasLoaded) ? this.contentimg : null;
    if (img) {
      ctx.globalAlpha = this.c_opacity;
      ctx.drawImage(img, this.c_trs[4], this.c_trs[5], 80, 25);
    }
  }
  
}

function Content_time_z3_canvasscriptlayer(a_layerIndex, a_layerID, a_containingElement, a_name, a_renderProperties) {
  ScriptLayer.call(this, a_layerIndex, a_layerID, a_containingElement, a_name, a_renderProperties);
  
  /*
     This JavaScript program draws a clock that shows the current time.
     The clock is sized to fit the current layer.
  
     This code was provided by the Mozilla Foundation as part of Firefox programming examples.
     It is in the public domain.
     The code was slightly modified for Radi by Pauli Ojala.
     Original:
     https://developer.mozilla.org/en/Canvas_tutorial/Basic_animations#An_animation_example_2
  */
  
  
  /* the "this" object represents the current layer in Radi.
     this is the method that is called to render the layer's content.
     to access timeline properties, Radi provides the "env" object.
     for example, you could get the current frame through "env.currentFrame". */
  this.generateInCanvas = function(canvas) {
    var ctx = canvas.getContext('2d'); 
    var w = canvas.width;
    var h = canvas.height;
  
    ctx.clearRect(0, 0, w, h);
  
    // draw the clock so that it fits in the canvas and is positioned in the top-left corner
    var clockSize = (h < w) ? h : w;
    var clockCenterX = clockSize/2;
    var clockCenterY = clockSize/2;
  
    // the 'drawClock' function uses fixed pixel coordinates, where the size of the clock is
    // about 300 pixels. we pass a scale parameter which tells the drawing function how to scale.
    this.drawClock(ctx, clockCenterX, clockCenterY, clockSize/300);
  }
  
  this.drawClock = function(ctx, x, y, scale) {
    var now = new Date();
    ctx.save();
    ctx.translate(x, y);
    ctx.scale(scale, scale);
    ctx.rotate(-Math.PI/2);
    ctx.strokeStyle = "black";
    ctx.fillStyle = "white";
    ctx.lineWidth = 8;
    ctx.lineCap = "round";
  
    // Hour marks
    ctx.save();
    for (var i=0;i<12;i++){
      ctx.beginPath();
      ctx.rotate(Math.PI/6);
      ctx.moveTo(100,0);
      ctx.lineTo(120,0);
      ctx.stroke();
    }
    ctx.restore();
  
    // Minute marks
    ctx.save();
    ctx.lineWidth = 5;
    for (i=0;i<60;i++){
      if (i%5!=0) {
        ctx.beginPath();
        ctx.moveTo(117,0);
        ctx.lineTo(120,0);
        ctx.stroke();
      }
      ctx.rotate(Math.PI/30);
    }
    ctx.restore();
    
    var sec = now.getSeconds();
    var min = now.getMinutes();
    var hr  = now.getHours();
    hr = hr>=12 ? hr-12 : hr;
  
    ctx.fillStyle = "black";
  
    // write Hours
    ctx.save();
    ctx.rotate( hr*(Math.PI/6) + (Math.PI/360)*min + (Math.PI/21600)*sec )
    ctx.lineWidth = 14;
    ctx.beginPath();
    ctx.moveTo(-20,0);
    ctx.lineTo(80,0);
    ctx.stroke();
    ctx.restore();
  
    // write Minutes
    ctx.save();
    ctx.rotate( (Math.PI/30)*min + (Math.PI/1800)*sec )
    ctx.lineWidth = 10;
    ctx.beginPath();
    ctx.moveTo(-28,0);
    ctx.lineTo(112,0);
    ctx.stroke();
    ctx.restore();
    
    // Write seconds
    ctx.save();
    ctx.rotate(sec * Math.PI/30);
    ctx.strokeStyle = "#D40000";
    ctx.fillStyle = "#D40000";
    ctx.lineWidth = 6;
    ctx.beginPath();
    ctx.moveTo(-30,0);
    ctx.lineTo(83,0);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(0,0,10,0,Math.PI*2,true);
    ctx.fill();
    ctx.beginPath();
    ctx.arc(95,0,10,0,Math.PI*2,true);
    ctx.stroke();
    ctx.fillStyle = "#555";
    ctx.arc(0,0,3,0,Math.PI*2,true);
    ctx.fill();
    ctx.restore();
  
    ctx.beginPath();
    ctx.lineWidth = 14;
    ctx.strokeStyle = '#325FA2';
    ctx.arc(0,0, 142, 0, Math.PI*2,true);
  
    ctx.stroke();
  
    ctx.restore();
  }
  
}

var layers = [
  new Content_time_z2_textlayer(0, 'time_z2_textlayer', 'time_z1_canvas', 'Text layer', {}),
  new Content_time_z3_canvasscriptlayer(1, 'time_z3_canvasscriptlayer', 'time_z1_canvas', 'Script layer', {})
];

var elements = [
  { "htmlID": "time_z1_canvas", "name": "Canvas element", "layerIndexes": [0,1], "describeAtFrame": function(frame) { var infr = 0; var dur = -1; var isVisible = (frame >= infr && (dur < 0 || frame < infr+dur)); return { 'isVisible': isVisible, 'needsRender': true, 'needsClear': true, 'hasScriptContent' : true } }, "eventHandlers": { }, "setup": function() {} }];



var timelineEvents = [
[{ "type": "playback", "frame": 0, "value": "play", "attributes": {} },{ "type": "x", "frame": 0, "value": function() { if ( !this._radi_x_772c6) { var r = {}; r.visid = env.visid; $.ajax({type:'POST',url:'772c6',data:JSON.stringify(r),dataType:'json',contentType:'application/json',success: function(d) {  if (d.result && d.result.visid) env.visid = d.result.visid;} });this._radi_x_772c6 = true; } }, "attributes": {} }]];

function SceneRoot_time(elements, layers) {
  /* This is the script for the scene root object. It's accessible as a variable named env.scene in other scripts.
  
  Note that within this script, values need to be set on the 'this' object. For example: to set the default value for a property that will be accessed as 'env.scene.foo', you would enter:
    this.foo = 'Hello world'; */}

var root = new SceneRoot_time(elements, layers);
root.xenv = {};
var ua = navigator.userAgent.toLowerCase();
var osiOS = (ua.indexOf('iphone') != -1 || ua.indexOf('ipad') != -1 || ua.indexOf('ipod') != -1);
var isWebKit = (ua.indexOf('webkit') != -1);

function updateTime() {
  var evs = (currentFrame < timelineEvents.length) ? timelineEvents[currentFrame] : null;
  var n = (evs) ? evs.length : 0;
  for (var i = 0; i < n; i++) {
    var ev = evs[i];
    if ( !ev.type || ev.value === undefined) continue;
    if (ev.type == 'playback') {
	  if (ev.value == 'goto') {
	    if (ev.attributes.targetFrameIndex !== undefined) {
         var prevFrame = currentFrame;
         currentFrame = ev.attributes.targetFrameIndex;
         var ts = currentFrame / frameRate;
         for (var i = 0; i < elements.length; i++) {
             var elInfo = elements[i];
             var el = document.getElementById(elInfo.htmlID);
             var elT = el.currentTime;
             if (elT !== undefined && frameRate > 0 && !isNaN(parseFloat(elT))) {
              var off = ts - (prevFrame / frameRate);
              el.currentTime = elT + off;
             }
         }
       }
	  } else {
        isPlaying = (ev.value != 'pause' && ev.value != 'stop');
      }
   }
   else if (ev.type == 'script') {
    try {
	  ev.value.call(window);
    } catch(err) {};
   }
   else if (ev.type == 'x') {
    try {
	  ev.value.call(root.xenv);
    } catch(err) {if (window.console) window.console.log('** x failed: '+err)};
   }
   else if (ev.type == 'anim') {
    var target = ev.attributes.target || null;
    var prop = ev.attributes.targetProperty || null;
    var dur = ev.attributes.duration || 0;
    if (target && prop) {
	  var eld = null;
	  for (var ei = 0; ei < elements.length; ei++) {
	    if (target == elements[ei].name) {
		  eld = elements[ei]; break;
		}
	  }
	  var el = (eld !== null) ? $('#'+eld.htmlID) : null;
	  if (el !== null) {
	    var css = {};
	    css[prop] = ev.value;
	    if (dur <= 0) {
	      el.css(css);
	    } else {
	      el.animate(css, dur*1000);
	    }
	  }
    }
   }
  }

  env.currentFrame = currentFrame;
  env.scene = root;
  
  var n = elements.length;
  for (var i = 0; i < n; i++) {
    var elInfo = elements[i];
    var desc = elInfo.describeAtFrame(currentFrame);
    var isVis = desc.isVisible;
    if (elInfo.rt_isVis === undefined || elInfo.rt_isVis != isVis) {
      elInfo.rt_isVis = isVis;
      document.getElementById(elInfo.htmlID).style.visibility = (isVis)?'visible':'hidden';
    }
    if (desc.needsLoad && !elInfo.rt_loaded) {
      elInfo.rt_loaded = true;
      var element = document.getElementById(elInfo.htmlID);
      if (element.load && isWebKit) {
        var desc_l = elInfo.describeAtFrame(currentFrame);
        element.addEventListener('loadeddata', function(ev){var el = ev.target; if(desc_l.isVisible){ el.style.visibility = 'visible' }; el.style.opacity = (elInfo.glFilter) ? 0.01 : 1;}, true);
        element.load();
      } else {
        if (isVis) element.style.visibility = 'visible';
        element.style.opacity = (elInfo.glFilter) ? 0.01 : 1;
      }
    }
    if (desc.needsPlay && !elInfo.rt_played) {
      elInfo.rt_played = true;
      var element = document.getElementById(elInfo.htmlID);
      if ( !osiOS && element.play) {
        element.play();
      } else {
        element.style.visibility = 'visible'; element.style.opacity = (elInfo.glFilter) ? 0.01 : 1;
        if (element.controls !== undefined) element.controls = true;
      }
    }
    var needsRender = ( !animDidStart) ? true : desc.needsRender;
    if (currentFrame >= durationInFrames) {
      needsRender = (desc.hasScriptContent) ? true : false;
    }
    if (elInfo.glFilter) needsRender = true;
    if (needsRender) {
      var element = document.getElementById(elInfo.htmlID);
      if (element.getContext && ( !animDidStart || desc.needsClear)) {
        element.getContext('2d').clearRect(0, 0, element.width, element.height);
      }
      var larr = elInfo.layerIndexes;
      var nl = larr.length;
      for (var j = 0; j < nl; j++) {
        var layer = layers[larr[j]];
        if (layer.applyKf) layer.applyKf(currentFrame);
      }
      if (elInfo.eventHandlers.enterframe) elInfo.eventHandlers.enterframe(undefined, env);
      for (var j = nl-1; j >= 0; j--) {
        var layer = layers[larr[j]];
        if (element.getContext && layer.generateInCanvas) {
          var ctx = element.getContext('2d');
          ctx.save();
          if (layer._enterScriptExec) layer._enterScriptExec();
          layer.generateInCanvas(element, layers);
          if (layer._exitScriptExec) layer._exitScriptExec();
          ctx.restore();
        }
      }
      if (elInfo.glFilter) {
        elInfo.glFilter.renderWithSourceElement(element);
      }
    }
  }
  animDidStart = true;
}

var useInterval = (window.requestAnimationFrame === undefined);
var intervalID = -1;
var startT = 0;
var lastFrameIdx = -1;

function updateByTimer() {
  if ( !isPlaying) return;
  var t = (Date.now() - startT)/1000;
  var f = Math.floor(t*frameRate);
  if (f != lastFrameIdx) {
    currentFrame = f;
    updateTime();
    lastFrameIdx = f;
  }
  if ( !useInterval) window.requestAnimationFrame(updateByTimer);
}

return {
  'getEnv': function() { return env; },
  'renderAtFrame': function(t) {
    currentFrame = t;
    updateTime();
  },
  'goToFrame': function(t) {
    currentFrame = t;
    if ( !isPlaying) updateTime();
  },
  'getLayer': function(index) {
    return (index < layers.length) ? layers[index] : null;
  },
  'getLayerById': function(lid) {
    for (var i = 0; i < layers.length; i++) {
      if (layers[i].layerID === lid) return layers[i];
    }
    return null;
  },
  'getLayerByName': function(lid) {
    for (var i = 0; i < layers.length; i++) {
      if (layers[i].name === lid) return layers[i];
    }
    return null;
  },
  'getElementByName': function(eid) {
    for (var i = 0; i < elements.length; i++) {
      if (elements[i].name === eid) return elements[i];
    }
    return null;
  },
  'start': function() {
	 isPlaying = true;
    startT = Date.now();
    lastFrameIdx = -1;
    if (useInterval) {
      if (intervalID != -1) window.clearInterval(intervalID);
      intervalID = window.setInterval(updateByTimer, 1000 * (1.0/frameRate));
    } else {
      window.requestAnimationFrame(updateByTimer);
    }
  },
  'stop': function() {
	isPlaying = false;
	window.clearInterval(intervalID);
	intervalID = -1;
  },
  'setupElements': function() {
   preloadAssets();
	for (var i = 0; i < elements.length; i++) {
	  elements[i].setup();
	}
  }
}
})();
</script>
</head>

<body>
<div id="radidoc_time" style="position:relative; width:640px; height:360px;">
<canvas id='time_z1_canvas' width='640' height='360' style='position: absolute; width: 640px; height: 360px; left: 0px; top: 0px; z-index: 1;'>This content cannot be displayed because your browser does not support the HTML 5 canvas tag.</canvas>

</div>
<script type="text/javascript">
$(document).ready(function($){
  var rd = Radi.documents['time'];
  var env = rd.getEnv();
  rd.setupElements();
  var autosize = function(){
    var elInfo, els, el, elW, elH, x, y;
    var winH = $(window).height();  var winW = $(window).width();
  };
  $(window).bind('load resize', autosize);
  autosize();
  rd.renderAtFrame(0); rd.start();
});
</script>

</body>
</html>